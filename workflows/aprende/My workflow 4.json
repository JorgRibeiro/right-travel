{
  "name": "My workflow 2",
  "nodes": [
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.1-2025-11-13",
          "mode": "list",
          "cachedResultName": "gpt-5.1-2025-11-13"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -320,
        224
      ],
      "id": "eda95956-3452-48e2-a6eb-e19f0ca64610",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "tkKS5g4EKLMRBwWj",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "contextWindowLength": 20
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -192,
        224
      ],
      "id": "8cd6337d-eda3-4b52-bc1c-22dce52484b1",
      "name": "Simple Memory1"
    },
    {
      "parameters": {
        "toolDescription": "Use esta ferramenta para buscar op√ß√µes de hospedagem, hot√©is e alugu√©is de temporada diretamente no Google Hotels. √â ideal para obter pre√ßos, avalia√ß√µes e disponibilidade em tempo real. Inputs obrigat√≥rios: Localiza√ß√£o ou nome do hotel (par√¢metro 'q'), data de check-in, data de check-out e n√∫mero de adultos envolvidos nessa viajem. Use sempre que o plano de viagem exigir uma estadia.",
        "url": "https://serpapi.com/search.json",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "engine",
              "value": "google_hotels"
            },
            {
              "name": "q",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters1_Value', `Required\nParameter defines the search query. You can use anything that you would use in a regular Google Hotels search.`, 'string') }}"
            },
            {
              "name": "check_in_date",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters2_Value', `Required\nParameter defines the check-in date. The format is YYYY-MM-DD. e.g. 2026-01-23`, 'string') }}"
            },
            {
              "name": "check_out_date",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters3_Value', `Required\nParameter defines the check-out date. The format is YYYY-MM-DD. e.g. 2026-01-24`, 'string') }}"
            },
            {
              "name": "adults",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters4_Value', `Optional\nParameter defines the number of adults. Default to 2.`, 'string') }}"
            },
            {
              "name": "currency",
              "value": "BRL"
            },
            {
              "name": "api_key",
              "value": "=7020fdeced29cf0c4a8ca7f140ec4870219905a1119668c05308ba1687e74fdb"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        -64,
        224
      ],
      "id": "16ac1b03-18d7-4e35-b2df-2492ff27bd4c",
      "name": "Google Hotels_search"
    },
    {
      "parameters": {
        "toolDescription": "Use esta ferramenta para buscar op√ß√µes de voos diretamente no Google Flights.\n√â ideal para obter pre√ßos, companhias a√©reas, dura√ß√£o, escalas e disponibilidade em tempo quase real.\nInputs obrigat√≥rios: aeroporto ou cidade de origem (departure_id), aeroporto ou cidade de destino (arrival_id), data de ida (check_in_date) e a data de volta (check_out_date) .\nInputs opcionais: n√∫mero de adultos e crian√ßas.\nRegras:Use esse formato para datas: YYYY/MM/DD\nUse esta ferramenta sempre que o plano de viagem exigir deslocamento a√©reo entre cidades.",
        "url": "https://serpapi.com/search.json",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "engine",
              "value": "google_flights"
            },
            {
              "name": "departure_id",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters1_Value', `IATA MODEL`, 'string') }}"
            },
            {
              "name": "api_key",
              "value": "=7020fdeced29cf0c4a8ca7f140ec4870219905a1119668c05308ba1687e74fdb"
            },
            {
              "name": "currency",
              "value": "BRL"
            },
            {
              "name": "arrival_id",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters4_Value', `IATA MODEL`, 'string') }}"
            },
            {
              "name": "outbound_date",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters5_Value', `should be in the format of YYYY-MM-DD. E.g. 2023-01-31.`, 'string') }}"
            },
            {
              "name": "return_date",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters6_Value', `should be in the format of YYYY-MM-DD. E.g. 2023-01-31.`, 'string') }}"
            },
            {
              "name": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters7_Name', ``, 'string') }}",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters7_Value', ``, 'string') }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        112,
        256
      ],
      "id": "236e5a2d-03a3-4e7f-9fef-3e0a3cbcd752",
      "name": "Google Flights_search"
    },
    {
      "parameters": {
        "toolDescription": "Use esta ferramenta para pesquisar atra√ß√µes tur√≠sticas, pontos de interesse, restaurantes e ler avalia√ß√µes detalhadas de viajantes no Tripadvisor. √â a ferramenta principal para planejar roteiros, descobrir 'o que fazer' em um destino e verificar a popularidade de locais. Input principal: O nome da cidade ou ponto tur√≠stico no par√¢metro 'q'. Use sempre que o usu√°rio pedir recomenda√ß√µes de lazer ou quiser saber a opini√£o de outros viajantes.",
        "url": "https://serpapi.com/search.json",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "q",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', `Required\nO termo de busca para o Tripadvisor. Deve conter obrigatoriamente o nome da cidade, um ponto tur√≠stico espec√≠fico ou o nome de uma atra√ß√£o. Exemplos: 'Paris', 'Cristo Redentor', 'Museu do Louvre'. N√£o inclua datas ou n√∫mero de pessoas neste campo.`, 'string') }}"
            },
            {
              "name": "api_key",
              "value": "=7020fdeced29cf0c4a8ca7f140ec4870219905a1119668c05308ba1687e74fdb"
            },
            {
              "name": "ssrc",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters2_Value', `Optional\nThis parameter specifies the search filter you want to use for the Tripadvisor search.\nAvailable options:\na - All Results\nr - Restaurants\nA - Things to Do\nh - Hotels\ng - Destinations\nv - Vacation Rentals\nf - Forums\n\nNOTE: Tripadvisor has discontinued support for Vacation Rentals. As a result, using ssrc=v may return incomplete results or no results at all.`, 'string') }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        256,
        256
      ],
      "id": "20ba95bd-585c-4844-9699-e95066a3edf5",
      "name": "Google Tripadvisor_search"
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Use esta ferramenta quando o usu√°rio fornecer uma informa√ß√£o nova e √∫til para lembrar depois (prefer√™ncias, datas, nomes, cidade, or√ßamento). Envie um √∫nico campo memory com uma frase curta resumindo o que deve ser lembrado.",
        "operation": "create",
        "base": {
          "__rl": true,
          "value": "appLzFWambPh8qsb3",
          "mode": "list",
          "cachedResultName": "Agent Memories",
          "cachedResultUrl": "https://airtable.com/appLzFWambPh8qsb3"
        },
        "table": {
          "__rl": true,
          "value": "tbll3xZKpyyu5xPq8",
          "mode": "list",
          "cachedResultName": "Table 1",
          "cachedResultUrl": "https://airtable.com/appLzFWambPh8qsb3/tbll3xZKpyyu5xPq8"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "User": "Jorge",
            "Memory": "={{ $fromAI('memory') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Memory",
              "displayName": "Memory",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "User",
              "displayName": "User",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Creadet",
              "displayName": "Creadet",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.airtableTool",
      "typeVersion": 2.1,
      "position": [
        432,
        272
      ],
      "id": "91166686-dad5-44b5-bce7-737c09e576d2",
      "name": "Save Memory",
      "credentials": {
        "airtableTokenApi": {
          "id": "sRnJlmxf8IOcFa1i",
          "name": "Airtable Personal Access Token account"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "responseMode": "responseNodes"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.4,
      "position": [
        -1216,
        16
      ],
      "id": "f5555bf9-2887-4c95-aab0-b61eb4a5a8d8",
      "name": "When chat message received",
      "webhookId": "c686848c-b36e-4c28-abea-074f4f05a592",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "appLzFWambPh8qsb3",
          "mode": "list",
          "cachedResultName": "Agent Memories",
          "cachedResultUrl": "https://airtable.com/appLzFWambPh8qsb3"
        },
        "table": {
          "__rl": true,
          "value": "tbll3xZKpyyu5xPq8",
          "mode": "list",
          "cachedResultName": "Table 1",
          "cachedResultUrl": "https://airtable.com/appLzFWambPh8qsb3/tbll3xZKpyyu5xPq8"
        },
        "filterByFormula": "=({User} = 'Jorge')",
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        -976,
        176
      ],
      "id": "488c581e-88b3-4528-ad07-f65a2b8b12dd",
      "name": "Get Memories",
      "alwaysOutputData": true,
      "credentials": {
        "airtableTokenApi": {
          "id": "sRnJlmxf8IOcFa1i",
          "name": "Airtable Personal Access Token account"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "memories",
        "include": "specifiedFields",
        "fieldsToInclude": "Memory, Creadet",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -752,
        176
      ],
      "id": "5d60927e-0b46-44f7-8b42-76657869e81e",
      "name": "Aggregate"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -528,
        0
      ],
      "id": "9b4042c5-a6e8-436d-b3ee-52212e3aafc8",
      "name": "Merge"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "=ROLE\n\nVoc√™ √© um Agente de Viagens amig√°vel, confi√°vel e proativo.\nVoc√™ est√° conversando com {USER}, em portugu√™s (pt-BR).\nUse um tom humano, claro e acolhedor, com emojis moderados ‚úàÔ∏èüå¥\n\nOBJETIVO PRINCIPAL\n\nAjudar {USER} a planejar viagens completas (voos, hot√©is e atra√ß√µes), oferecendo op√ß√µes claras, comparadas e alinhadas √†s prefer√™ncias dele, economizando tempo e dinheiro.\n\nMEM√ìRIA DO USU√ÅRIO (USO OBRIGAT√ìRIO)\n\nSempre que o usu√°rio enviar uma nova mensagem, verifique se ela cont√©m informa√ß√µes est√°veis e reutiliz√°veis, como:\n\ncidade ou aeroporto de origem\n\nlocal onde o usu√°rio mora\n\nor√ßamento recorrente\n\nprefer√™ncias de voo ou hospedagem\n\nestilo de viagem\n\nn√∫mero habitual de viajantes\n\nSe contiver, use a ferramenta Save Memory para armazenar um resumo objetivo dessas informa√ß√µes.\nNunca informe ao usu√°rio que algo foi salvo.\n\nINTERPRETA√á√ÉO DE MEM√ìRIA (REGRA CR√çTICA)\n\nQualquer mem√≥ria que indique localiza√ß√£o do usu√°rio (ex.: ‚Äúmoro em Recife‚Äù, ‚Äúsou de Recife‚Äù, ‚Äúcidade: Recife‚Äù, ‚Äúlocaliza√ß√£o atual‚Äù) DEVE ser interpretada como a origem padr√£o do usu√°rio.\n\nEssa origem padr√£o deve ser usada automaticamente sempre que o usu√°rio n√£o informar explicitamente a origem.\n\nS√≥ pergunte a origem se n√£o existir nenhuma informa√ß√£o de localiza√ß√£o na mem√≥ria.\n\nSe a mem√≥ria indicar apenas uma cidade, assuma o principal aeroporto comercial dessa cidade como origem.\n\nEm caso de conflito, a mensagem atual do usu√°rio sempre tem prioridade.\nUse a data e hora das mem√≥rias para considerar apenas prefer√™ncias mais recentes e atualize a mem√≥ria quando novos padr√µes se repetirem.\n\nMODO DE OPERA√á√ÉO (SEM EXPOR RACIOC√çNIO INTERNO)\n\nSempre siga este fluxo:\n\n1Ô∏è‚É£ Entender o pedido\n\nExtraia, quando dispon√≠veis:\n\nCidade de origem (+ IATA)\n\nCidade de destino (+ IATA)\n\nData de ida\n\nData de volta\n\nN√∫mero de adultos\n\nN√∫mero de crian√ßas\n\nOr√ßamento\n\nPrefer√™ncias (pre√ßo, conforto, hor√°rios, escalas, hospedagem, estilo)\n\n2Ô∏è‚É£ Completar com padr√µes inteligentes (defaults)\n\nAno ausente ‚Üí usar ano atual\n\nOrigem ausente ‚Üí usar automaticamente a origem padr√£o obtida da mem√≥ria\n\nPassageiros ausentes ‚Üí adults = 1, children = 0\n\nSempre informe ao usu√°rio quando alguma suposi√ß√£o for aplicada.\n\n3Ô∏è‚É£ Buscar informa√ß√µes\n\nAssim que tiver os dados m√≠nimos, utilize as ferramentas apropriadas:\n\nGoogle Flight_search ‚Üí voos\n\nGoogle Hotels_search ‚Üí hot√©is\n\nGoogle TripAdvisor_search ‚Üí atra√ß√µes\n\n4Ô∏è‚É£ Recomendar\n\nFiltre resultados, compare op√ß√µes e explique por que cada escolha faz sentido para {USER}.\n\n5Ô∏è‚É£ Refinar\n\nSe necess√°rio, fa√ßa no m√°ximo 2 perguntas por resposta para ajustar a recomenda√ß√£o.\n\nUSO DE FERRAMENTAS (REGRAS OBRIGAT√ìRIAS)\n\n‚úàÔ∏è Google Flight_search\nUse somente quando tiver:\n\nOrigem (cidade ou IATA)\n\nDestino (cidade ou IATA)\n\nData de ida (e volta, se aplic√°vel)\n\nN√∫mero de passageiros\n\nüè® Google Hotels_search\nUse somente quando tiver:\n\nDestino\n\nCheck-in\n\nCheck-out\n\nN√∫mero de adultos\nSe n√£o houver informa√ß√£o nem na mensagem nem na mem√≥ria, use 1 adulto.\n\nüó∫Ô∏è Google TripAdvisor_search\nUse quando:\n\n{USER} pedir atra√ß√µes, roteiro ou ‚Äúo que fazer‚Äù\n\nOu quando complementar a experi√™ncia fizer sentido\n\nüö´ Se os dados m√≠nimos n√£o estiverem dispon√≠veis, n√£o chame a API ‚Äî pergunte apenas o essencial.\n\nPRE√áOS E HIST√ìRICO\n\nNunca invente pre√ßos antigos.\n\nS√≥ compare com hist√≥rico se o workflow fornecer dados reais.\n\nCaso contr√°rio, explique tend√™ncias sazonais.\n\nFORMATO PADR√ÉO DE RESPOSTA (SEMPRE USAR)\n\n‚úÖ Resumo\nO que foi entendido + suposi√ß√µes aplicadas.\n\n‚úàÔ∏è Voos (se aplic√°vel)\nAt√© 3 op√ß√µes com:\n\nCompanhia\n\nPre√ßo aproximado\n\nHor√°rio\n\nDura√ß√£o\n\nEscalas\nDestaque a melhor op√ß√£o e justifique.\n\nüè® Hot√©is (se aplic√°vel)\nAt√© 3 op√ß√µes com:\n\nNome\n\nPre√ßo m√©dio/noite\n\nLocaliza√ß√£o\n\nAvalia√ß√£o\nDestaque a melhor op√ß√£o e justifique.\n\nüó∫Ô∏è Atra√ß√µes / Roteiro (se aplic√°vel)\nSugira por regi√£o ou por dia, adaptado ao estilo da viagem.\n\n‚ùì Perguntas r√°pidas (m√°x. 2)\nApenas o necess√°rio para avan√ßar.\n\nüîú Pr√≥ximos passos\nExplique claramente o que pode ser feito a seguir.\n\nLIMITES E BOAS PR√ÅTICAS\n\nSeja claro, direto e √∫til.\n\nEvite respostas gen√©ricas.\n\nNunca fa√ßa mais de 2 perguntas por turno.\n\nPriorize sempre custo-benef√≠cio e clareza.",
          "returnIntermediateSteps": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        -80,
        0
      ],
      "id": "59b92d3d-ef29-4176-aa3d-a7737a489762",
      "name": "AI Agent",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "message": "={{ $json.output }}",
        "waitUserReply": false,
        "options": {
          "memoryConnection": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chat",
      "typeVersion": 1,
      "position": [
        336,
        0
      ],
      "id": "66f5ace4-98c8-4d49-8d87-bd465fb2e4d0",
      "name": "Respond to Chat"
    }
  ],
  "pinData": {},
  "connections": {
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory1": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Google Hotels_search": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Flights_search": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Tripadvisor_search": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Save Memory": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "Get Memories",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Get Memories": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Respond to Chat",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "0588cb07-2bae-4872-9a99-ecf17e7373a1",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "22ea323b6c85fbb2de3a8dedaefae6ec8edb82e9c1e169fef139445834eee221"
  },
  "id": "4-Mxzy4OwZfVgd3V1ZeDD",
  "tags": []
}